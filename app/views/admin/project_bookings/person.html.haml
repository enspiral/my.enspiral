- title("#{@person.name}'s work capacity.")
- if !@person.default_hours_available
  %h3.centered Warning!
  %p.centered #{@person.name} has not yet specified default hours available

%div.right-link=link_to 'Next >>', url_for(:dates => @next_weeks)
%div.right-link=link_to '<< Previous', url_for(:dates => @previous_weeks)

%table.capacity
  %tbody
    %tr
      %th 
        %strong Capacity
      - @formatted_dates.each do |date|
        %th.centered
          %strong= date
      %th &nbsp;

    %tr
      %td Bookings (% Booked)
      - @project_bookings_totals.each do |week, total_hours|
        - if @person.default_hours_available
          %td.centered= number_to_percentage(((total_hours.to_f / @person.default_hours_available.to_f) * 100 ), :precision => 0)
      %td &nbsp;

    -#%tr

      -#%td &nbsp;
      -#- @project_bookings_totals.each do |week, total_hours|
        -#- free_time = (@person.default_hours_available || 0) - total_hours
        -#%td.centered
          -#- if free_time < 0
            -##{image_tag 'time-invalid.jpg', :size => '30x30'}
          -#- if free_time > 0
            -##{image_tag 'time-valid.jpg', :size => '30x30'}
    
    %tr
      %td &nbsp;

    %tr
      %td Total Bookings (Hours)
      - @project_bookings_totals.each do |week, total_hours|
        %td.centered #{total_hours}
      %td &nbsp;
    
    %tr
      %td Free Time (Hours)
      - @project_bookings_totals.each do |week, total_hours|
        - free_time = (@person.default_hours_available || 0) - total_hours
        %td.centered
          = free_time
    %tr
      %td &nbsp;

    %tr
      %th
        %strong Projects (Hours)
      %th &nbsp;
      %th &nbsp;
      %th &nbsp;
      %th &nbsp;
      %th &nbsp;
      %th &nbsp;


    - @project_bookings.each do |project_id, bookings|
      %tr
        %td= link_to get_project_name(project_id), project_path(project_id)
        - bookings.each do |week, time|
          %td.centered= time
        -#%td.centered= link_to 'Edit', staff_capacity_edit_path(:project_id => project_id, :dates => @current_weeks)

%br
%table.capacity-legend
  %tr
    %th 
      %strong Legend:
    %th &nbsp;
  %tr
    %td spare time available: 
    %td #{image_tag 'time-valid.jpg', :size => '30x30'}
  %tr
    %td not enough time: 
    %td #{image_tag 'time-invalid.jpg', :size => '30x30'}
  %tr
    %td changes pending approval: 
    %td #{image_tag 'time-pending.jpg', :size => '30x30'}

%p
  %strong Default Hours Per Week: 
  #{@person.default_hours_available}

